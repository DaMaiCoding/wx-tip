# wxTip 项目说明文档

wxTip 是一个致力于增强 Windows PC 版微信体验的工具箱。它通过**完全非侵入式**的方式（基于 UI Automation 技术），提供安全可靠的防撤回功能和增强的消息通知体验。

## 核心功能

### 1. 安全防撤回 (Safe Anti-Revoke)
- **原理**：采用独创的**影子信箱 (Shadow Inbox)** 技术。系统在本地内存中维护一个即时的聊天记录副本，当检测到“撤回了一条消息”的提示时，自动从历史记录中匹配并恢复被撤回的内容。
- **优势**：
  - **零风险**：不修改微信任何 DLL 文件，不注入任何代码，完全基于视觉层面的 UI 自动化，无封号风险。
  - **全版本支持**：理论上支持所有 Windows 微信版本（只要界面结构不发生颠覆性变化）。
  - **历史记录**：提供独立的“撤回记录”面板，可查看所有被拦截的撤回消息。

### 2. 消息通知增强 (Notification Plus)
- **原理**：实时监控微信窗口 UI 元素，提取新消息内容。
- **功能**：
  - **系统通知**：调用 Windows 原生通知中心推送消息。
  - **自定义弹窗**：提供现代化的自定义弹窗（Custom Popup），支持深色模式，界面更美观。
  - **后台接收**：即使微信窗口被遮挡（需保持在任务栏可见），也能收到通知。
  - **隐私安全**：所有数据仅在本地内存流转，绝不上传服务器。

## 使用指南

### 开发环境运行

1. **安装依赖**：
   ```bash
   npm install
   ```

2. **启动应用**：
   ```bash
   npm run dev
   ```

### 打包与构建

- **构建 Windows 安装包**：
  ```bash
  npm run build:win
  ```
  构建完成后，安装包将位于 `dist/` 目录下。

- **构建绿色版 (Portable)**：
  ```bash
  npm run build:portable
  ```

## 常见问题 (FAQ)

#### Q: 防撤回功能需要什么条件？
**A:** 由于采用 UI 识别技术，需要满足以下条件：
1. **微信必须运行**：wxTip 依赖于微信客户端的运行。
2. **保持窗口活跃**：为了建立“影子信箱”，建议偶尔点击切换一下聊天窗口，以便 wxTip 同步最新的聊天记录到内存中。
3. **不要最小化到托盘**：如果微信完全最小化到系统托盘（任务栏无图标），UI 元素会被系统冻结，导致无法读取消息。请保持微信窗口在任务栏可见（可以被其他窗口遮挡）。

#### Q: 为什么有时候防撤回没反应？
**A:** 
- 如果是刚打开 wxTip，它还没有获取到历史消息，此时发生的撤回可能无法恢复。
- 如果撤回的消息不在当前可视区域内，且未被同步到历史记录中，可能无法恢复。
- 建议：保持 wxTip 在后台运行，它会自动尝试同步活跃窗口的消息。

#### Q: 这个项目安全吗？会封号吗？
**A:** **绝对安全**。与传统的“通过修改 WeChatWin.dll 实现防撤回”不同，本项目**不修改任何微信文件**，**不注入任何进程**。它仅仅像一个“屏幕阅读器”一样读取界面上的文字，因此不存在被微信官方检测为外挂的风险。

## 技术架构

- **前端**：Electron + HTML/CSS (提供操作界面和自定义弹窗)
- **后端**：Node.js (主进程，负责配置管理和历史记录存储)
- **核心服务**：PowerShell (UI Automation)
  - `monitor.ps1`: 负责实时扫描微信窗口、维护影子信箱、检测撤回事件。

## 目录结构

```
src/
├── main/              # Electron 主进程
│   ├── index.js       # 入口文件
│   └── services/      # 核心服务
│       └── monitor.ps1 # 消息监控与防撤回脚本
├── renderer/          # 渲染进程 (UI)
│   ├── index.html     # 主界面
│   ├── popup.html     # 自定义消息弹窗
│   └── ...
└── preload/           # 预加载脚本 (安全桥接)
```

## License

此项目使用 [MIT License](LICENSE) 开源许可证。

SPDX-License-Identifier: MIT

### 免责声明

本工具仅供技术研究与学习使用。
1. **风险自负**：使用者需自行承担因使用本工具而产生的任何后果。
2. **版权说明**：微信（WeChat）是腾讯公司的注册商标。本项目与腾讯公司无关。
3. **合规性**：请勿将本工具用于任何非法用途或违反微信用户协议的行为。
