# wxTip 项目说明文档

wxTip 是一个致力于增强 Windows PC 版微信体验的工具箱。它通过非侵入式的方式，提供防撤回补丁和系统级消息通知增强功能。

## 核心功能

### 1. 防撤回补丁 (Anti-Revoke)
- **原理**：直接修改微信客户端的核心库文件 `WeChatWin.dll`，将处理撤回消息的汇编指令（跳转指令）修改为无效操作，从而拦截撤回请求。
- **支持版本**：
  - WeChat 3.9.x
  - WeChat 4.0.x
  - WeChat 4.1.x
- **安全性**：操作前会自动备份原文件为 `.bak`，随时可手动还原。

### 2. 消息通知增强 (Notification)
- **原理**：利用 PowerShell 的 UI Automation 技术，实时监控微信窗口的 UI 元素树，提取最新消息内容，并通过 Electron 调用 Windows 原生通知 API 进行推送。
- **特点**：
  - 即使微信处于后台，也能通过系统弹窗看到消息内容。
  - 支持点击通知快速查看。
  - **隐私说明**：所有消息仅在本地内存中流转，不上传任何服务器。

## 使用指南

### 开发环境运行
1. **安装依赖**：
   ```bash
   npm install
   ```
2. **启动应用**：
   ```bash
   npm run dev
   ```

### 常见问题 (FAQ)

#### Q: 为什么消息通知没有生效？
**A:** 消息监控依赖于 Windows UI Automation 技术，存在以下局限性：
1. **微信必须运行且未最小化到托盘**：如果微信完全最小化到系统托盘（任务栏没有图标），UI 元素会被系统隐藏，导致无法读取。请保持微信窗口在任务栏可见（可以被其他窗口遮挡，但不能最小化到托盘）。
2. **权限问题**：请尝试以**管理员身份**运行本程序。
3. **微信版本差异**：如果微信界面结构发生巨大变化，可能需要更新监控脚本。

#### Q: 防撤回补丁提示“文件被占用”？
**A:** 请先彻底退出微信（右键托盘图标 -> 退出），然后再应用补丁。

#### Q: 这个项目和 `notify-server` 有什么区别？
**A:** 
- **wxTip (本项目)**：是**客户端监听**工具。它像一只眼睛盯着你的微信窗口，看到新消息就弹窗提醒你。它依赖于微信 PC 客户端的运行。
- **notify-server**：通常指基于微信 API（如企业微信应用）的**服务端推送**工具。它是主动向你的微信发送消息（如天气、提醒），而不是读取你的聊天记录。
- 两者功能方向相反：wxTip 是“读消息”，notify-server 是“发消息”。

## 技术架构

- **前端**：Electron + HTML/CSS (原生界面)
- **后端**：Node.js (主进程) + Express (内部消息转发)
- **底层**：PowerShell (UI Automation 监控脚本)

## 目录结构
```
src/
├── main/              # Electron 主进程
│   ├── index.js       # 入口文件
│   └── services/      # 核心服务
│       ├── monitor.ps1 # 消息监控脚本
│       └── patcher.js  # 防撤回补丁逻辑
├── renderer/          # 渲染进程 (UI)
│   ├── index.html
│   ├── index.js
│   └── styles.css
└── preload/           # 预加载脚本 (安全桥接)
```

## License

此项目使用 [MIT License](LICENSE) 开源许可证。

SPDX-License-Identifier: MIT

### 免责声明

本工具仅供技术研究与学习使用。
1. **风险自负**：使用者需自行承担因使用本工具而产生的任何后果（包括但不限于账号风险、软件异常等）。
2. **版权说明**：微信（WeChat）是腾讯公司的注册商标。本项目与腾讯公司无关。
3. **合规性**：请勿将本工具用于任何非法用途或违反微信用户协议的行为。
